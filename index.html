<!DOCTYPE html>
<html lang="tr">
<head>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ecem & melih</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        /* FotoÄŸraf tÄ±klandÄ±ÄŸÄ±nda aÃ§Ä±lan pencere (Modal) */
#modalContent {
    max-width: 85%;     /* EkranÄ±n %85'inden fazla geniÅŸlemesin */
    max-height: 80vh;   /* Ekran yÃ¼ksekliÄŸinin %80'ini geÃ§mesin */
    width: auto;        /* Kendi oranÄ±nÄ± korusun */
    height: auto;
    border-radius: 12px;
    box-shadow: 0 5px 25px rgba(0,0,0,0.5);
    border: 3px solid white; /* FotoÄŸraf etrafÄ±na ÅŸÄ±k bir Ã§erÃ§eve */
}
        /* AnÄ±lar kÄ±smÄ±ndaki fotoÄŸraflarÄ±n boyutu */
.item-card img {
    width: 100%;        /* KartÄ±n geniÅŸliÄŸine uysun */
    max-height: 150px;  /* YÃ¼ksekliÄŸi sÄ±nÄ±rla, Ã§ok yer kaplamasÄ±n */
    object-fit: cover;  /* FotoÄŸrafÄ± bozmadan sÄ±ÄŸdÄ±r */
    border-radius: 8px; /* KÃ¶ÅŸeleri yumuÅŸat */
    cursor: pointer;
    transition: transform 0.2s;
}

.item-card img:hover {
    transform: scale(1.02); /* Ãœzerine gelince Ã§ok hafif bÃ¼yÃ¼sÃ¼n */
}
       .admin-delete-btn {
    display: none !important;
}
/* Ã‡arpÄ± butonlarÄ± normalde gizli */
.admin-delete-btn {
        position: absolute !important;
        top: 5px !important;
    left: 5px !important;
    z-index: 9999 !important;
    background: #ef4444 !important;
    color: white !important;
    border: none !important;
    border-radius: 50% !important;
    width: 22px !important;
    height: 22px !important;
    cursor: pointer !important;
    display: none !important; /* GÄ°ZLÄ° */
    align-items: center !important;
    justify-content: center !important;
    font-weight: bold !important;
}

/* Sadece admin modu aÃ§Ä±lÄ±nca Ã§arpÄ±larÄ± gÃ¶ster */
body.admin-active .admin-delete-btn {
    display: flex !important;
}

/* KutularÄ±n konumunu ayarla */
.msg, .item-card, .mem-bubble { position: relative !important; }
    .memory-card {
    background: var(--card-bg);
    border-radius: 20px;
    padding: 20px;
    width: 100%;
    max-width: 500px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
    margin-top: 20px;
}

.memory-stream {
    max-height: 600px;
    overflow-y: auto;
    display: flex;
    flex-direction: column; /* Tekli sÄ±ra iÃ§in */
    gap: 20px;
    padding: 10px;
}

.mem-bubble {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 15px;
    padding: 12px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    width: 100%; /* Tam geniÅŸlik */
    box-sizing: border-box;
}

.mem-img { 
    width: 100%; 
    height: auto; /* Kare zorunluluÄŸunu kaldÄ±rdÄ±k, orijinal boyutunda ÅŸÄ±k durur */
    border-radius: 10px; 
    cursor: pointer; 
}

/* Kimin gÃ¶nderdiÄŸine gÃ¶re kÃ¼Ã§Ã¼k bir renk farkÄ± */
.mem-Ecem { border-bottom: 3px solid #f43f5e; }
.mem-Melih { border-bottom: 3px solid #3b82f6; }

.mem-img { 
    width: 100%; 
    aspect-ratio: 1 / 1; /* FotoÄŸraflarÄ± kare yapar, daha dÃ¼zenli durur */
    object-fit: cover; 
    border-radius: 8px; 
    cursor: pointer; 
}

.mem-footer {
    margin-top: 8px;
    font-size: 10px;
}

.mem-user-name {
    font-weight: bold;
    display: block;
    color: #e2e8f0;
}

.mem-text {
    font-size: 12px;
    color: #cbd5e1;
    margin: 4px 0;
    word-break: break-word;
}

.mem-time {
    color: #64748b;
    font-size: 9px;
}

.mem-Ecem { align-self: flex-start; border-left: 4px solid #f43f5e; }
.mem-Melih { align-self: flex-end; border-right: 4px solid #3b82f6; text-align: right; }

.mem-info { font-size: 11px; color: #94a3b8; margin-bottom: 5px; font-weight: bold; text-transform: uppercase; }
.mem-date { font-size: 9px; color: #64748b; margin-top: 5px; }
.mem-img { width: 100%; border-radius: 10px; margin-top: 5px; cursor: pointer; transition: 0.3s; }
.mem-img:hover { opacity: 0.8; }
        body { background: #0f172a; color: white; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        .hidden { display: none; }
        
        #identityOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0f172a; z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .identity-card { background: #1e293b; padding: 40px; border-radius: 30px; box-shadow: 0 15px 35px rgba(0,0,0,0.5); text-align: center; border: 1px solid #334155; max-width: 450px; }
        .identity-btn { width: 200px; padding: 15px; margin: 10px; border: none; border-radius: 15px; font-weight: bold; cursor: pointer; font-size: 1.1rem; transition: 0.3s; color: white; }
        .btn-ecem { background: #ec4899; }
        .btn-melih { background: #3b82f6; }
        .identity-btn:hover { transform: translateY(-5px); filter: brightness(1.2); }

        #terminal { font-family: monospace; background: black; padding: 25px; border-radius: 15px; text-align: left; width: 100%; max-width: 600px; margin-top: 50px; border: 1px solid #1e293b; color: #10b981; line-height: 1.6; }

        .birthday-container { display: flex; justify-content: space-between; width: 100%; max-width: 1100px; margin-bottom: 25px; gap: 20px; }
        .bday-box { flex: 1; background: rgba(30, 41, 59, 0.7); padding: 15px; border-radius: 20px; text-align: center; border: 1px solid #334155; position: relative; }
        
        .ecem-special { border: 1px solid #ec4899; background: linear-gradient(145deg, #1e293b, #251628); }
        .ecem-special h4 { color: #f472b6; margin: 0; font-size: 0.85rem; letter-spacing: 1px; }
        .glow-text { color: #ec4899; font-weight: bold; animation: softGlow 3s ease-in-out infinite alternate; }
        
        @keyframes softGlow {
            from { text-shadow: 0 0 2px #fff, 0 0 5px #ec4899; }
            to { text-shadow: 0 0 4px #fff, 0 0 10px #ec4899; }
        }

        .melih-box h4 { color: #60a5fa; margin: 0; font-size: 0.85rem; letter-spacing: 1px; }
        .timer-val { font-size: 1.3rem; font-weight: bold; display: block; margin-top: 5px; }

        .mood-section { margin-bottom: 35px; text-align: center; width: 100%; }
        .mood-container { display: flex; justify-content: center; gap: 25px; flex-wrap: wrap; }
        .mood-wrapper { display: flex; flex-direction: column; align-items: center; gap: 5px; width: 70px; }
        .mood-label { font-size: 0.7rem; color: #94a3b8; text-transform: uppercase; }
        .mood-btn { cursor: pointer; font-size: 2.2rem; filter: grayscale(100%); transition: 0.3s; padding: 5px; }
        .mood-btn.active { filter: grayscale(0%); transform: scale(1.2); }
        .user-tag { font-size: 0.7rem; font-weight: bold; margin-top: 5px; min-height: 18px; display: flex; gap: 5px; }
        .tag-e { color: #ec4899; }
        .tag-m { color: #3b82f6; }

        .main-panel { display: flex; gap: 20px; width: 100%; max-width: 1400px; justify-content: center; flex-wrap: wrap; }
        .column-box { flex: 1; min-width: 300px; background: #1e293b; padding: 20px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); border: 1px solid #334155; display: flex; flex-direction: column; }

        h3 { margin-top: 0; border-bottom: 1px solid #334155; padding-bottom: 10px; text-align: center; }
        input { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #475569; background: #0f172a; color: white; margin-bottom: 10px; box-sizing: border-box; }
        .btn { border: none; padding: 10px; color: white; border-radius: 10px; width: 100%; font-weight: bold; cursor: pointer; }
        
        .scroll-area { flex-grow: 1; max-height: 250px; overflow-y: auto; margin-top: 10px; }
        .item-card { background: #0f172a; padding: 10px; border-radius: 10px; margin-bottom: 8px; font-size: 0.85rem; border-left: 3px solid #3b82f6; transition: 0.2s; }
        
        .spotify-slot { background: #0f172a; border-radius: 12px; padding: 5px; margin-bottom: 10px; border: 1px solid #334155; cursor: pointer; }
        .slot-label { font-size: 0.65rem; font-weight: bold; margin-left: 5px; margin-bottom: 3px; display: block; }
        .song-history-item { font-size: 0.75rem; padding: 8px; border-bottom: 1px solid #334155; cursor: pointer; color: #94a3b8; }
        .admin-trigger { position: fixed; bottom: 0; right: 0; width: 30px; height: 30px; cursor: pointer; opacity: 0; z-index: 9999; }
        
        #welcome-text { color: #94a3b8; font-style: italic; margin-bottom: 15px; font-size: 0.9rem; line-height: 1.4; }

        .chat-container { display: flex; flex-direction: column; height: 350px; }
        .chat-messages { flex-grow: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 8px; background: #0f172a; border-radius: 10px; margin-bottom: 10px; }
        .msg { max-width: 80%; padding: 8px 12px; border-radius: 15px; font-size: 0.85rem; position: relative; }
        .msg-ecem { align-self: flex-start; background: #ec4899; color: white; border-bottom-left-radius: 2px; }
        .msg-melih { align-self: flex-end; background: #3b82f6; color: white; border-bottom-right-radius: 2px; }
        .chat-input-row { display: flex; gap: 5px; position: relative; }
        .quick-msg-btn { background: #334155; border: none; color: white; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 1.5rem; }
        .quick-menu { position: absolute; bottom: 50px; left: 0; background: #1e293b; border: 1px solid #334155; border-radius: 10px; padding: 10px; display: none; grid-template-columns: repeat(2, 1fr); gap: 5px; z-index: 100; width: 250px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .quick-item { font-size: 0.75rem; padding: 5px; background: #0f172a; border-radius: 5px; cursor: pointer; text-align: center; }
        .quick-item:hover { background: #334155; }

        #map { height: 400px; border-radius: 20px; border: 1px solid #334155; margin-top: 25px; width: 100%; max-width: 1200px; z-index: 1; }
        .beating-heart { display: inline-block; animation: heartBeat 1.2s infinite; font-size: 26px; filter: drop-shadow(0 0 5px red); }
        @keyframes heartBeat { 0% { transform: scale(1); } 15% { transform: scale(1.3); } 30% { transform: scale(1); } }
        .map-label { background: rgba(15, 23, 42, 0.9); border: 1px solid #3b82f6; color: white; padding: 2px 10px; border-radius: 12px; font-size: 12px; font-weight: bold; margin-top: 5px; display: inline-block; }
.love-card-wrapper {
    width: 100%;
    display: flex;
    justify-content: center;
    margin: 20px 0 30px 0;
}

.love-card {
    background: linear-gradient(135deg, #db2777 0%, #ec4899 50%, #f472b6 100%);
    padding: 25px 50px;
    border-radius: 50px;
    box-shadow: 0 0 25px rgba(236, 72, 153, 0.5), inset 0 0 15px rgba(255, 255, 255, 0.3);
    cursor: pointer;
    position: relative;
    overflow: hidden;
    transition: transform 0.3s, box-shadow 0.3s;
    border: 2px solid rgba(255, 255, 255, 0.4);
    min-width: 350px;
    text-align: center;
    animation: floating 3s infinite ease-in-out;
}

.love-card:active { transform: scale(0.95); }

.love-content {
    color: white;
    font-weight: bold;
    font-size: 1.2rem;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    transition: opacity 0.3s;
}

.star-decor {
    position: absolute;
    color: white;
    opacity: 0.6;
    font-size: 14px;
    animation: blink 2s infinite;
}

@keyframes floating {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

@keyframes blink {
    0%, 100% { opacity: 1; scale: 1; }
    50% { opacity: 0.3; scale: 1.3; }
}
.note-ecem { border-left: 5px solid #ec4899 !important; background: rgba(236, 72, 153, 0.1) !important; }
.note-melih { border-left: 5px solid #3b82f6 !important; background: rgba(59, 130, 246, 0.1) !important; }
    </style>
</head>
<body>

    <div id="identityOverlay">
        <div class="identity-card">
            <h2 id="love-title" style="margin-bottom: 10px; color: #94a3b8;">HoÅŸ Geldin</h2>
            <p id="welcome-text">LÃ¼tfen profilini seÃ§erek baÅŸla...</p>
            <button class="identity-btn btn-ecem" onclick="setUser('ecem')">ECEM</button>
            <button class="identity-btn btn-melih" onclick="setUser('melih')">MELÄ°H</button>
        </div>
    </div>
    <div onclick="adminSisteminiAc()" style="position:fixed; bottom:0; right:0; width:40px; height:40px; cursor:pointer; z-index:1000000; background:transparent;"></div>

    <div id="step1" class="hidden" style="text-align:center; margin-top:100px;">
        <h1 style="letter-spacing: 3px;">ecem & melih</h1>
        <button class="btn" style="width:180px; background:#3b82f6;" onclick="startReset()">SÄ°STEME GÄ°R</button>
    </div>

    <div id="terminal" class="hidden"></div>

    <div id="step3" class="hidden" style="width:100%; max-width:1400px;">
        
       <div class="birthday-container">
    <div class="bday-box ecem-special">
        <h4>ğŸº ECEM'Ä°N DOÄUM GÃœNÃœ ğŸº</h4>
        <span id="ecemTimer" class="timer-val glow-text">-- : -- : -- : --</span>
        <div id="weather-ecem" class="weather-box">
            <div id="weather-ecem-main" style="font-weight: bold; color: #ec4899;"></div>
            <div id="weather-ecem-desc" style="color: #94a3b8; font-size: 0.7rem;"></div>
        </div>
    </div>

    <div style="display: flex; align-items: center; justify-content: center; min-width: 100px;">
        <img src="fenerbahÃ§e.jpg" alt="Amblem" style="height: 80px; width: auto; filter: drop-shadow(0 0 10px rgba(255,255,255,0.2));">
    </div>

    <div class="bday-box melih-box">
        <h4>ğŸ‚ MELÄ°H'Ä°N DOÄUM GÃœNÃœ ğŸ‚</h4>
        <span id="melihTimer" class="timer-val" style="color:#3b82f6;">-- : -- : -- : --</span>
        <div id="weather-melih" class="weather-box">
            <div id="weather-melih-main" style="font-weight: bold; color: #3b82f6;"></div>
            <div id="weather-melih-desc" style="color: #94a3b8; font-size: 0.7rem;"></div>
        </div>
    </div>
</div>

<div class="love-card-wrapper">
    <div class="love-card" onclick="sendLoveClick()">
        <div class="love-content">
            <span class="sparkle">âœ¨</span>
            <span id="love-text-display">Kalbimizden Bir ParÃ§a... â¤ï¸</span>
            <span class="sparkle">âœ¨</span>
        </div>
        <div id="love-stats" style="font-size: 0.75rem; margin-top: 10px; color: white; opacity: 0.9; font-weight: normal;">
        </div>
        <div class="star-decor" style="top:10%; left:5%;">â˜…</div>
        <div class="star-decor" style="bottom:10%; right:5%;">â˜…</div>
    </div>
</div>

<div class="mood-section">
            <div class="mood-container">
                <div class="mood-wrapper"><span class="mood-label">Kahve</span><span class="mood-btn" id="m-coffee" onclick="selectMood('coffee')">â˜•</span><div class="user-tag" id="tag-coffee"></div></div>
                <div class="mood-wrapper"><span class="mood-label">Oyun</span><span class="mood-btn" id="m-game" onclick="selectMood('game')">ğŸ®</span><div class="user-tag" id="tag-game"></div></div>
                <div class="mood-wrapper"><span class="mood-label">Uyku</span><span class="mood-btn" id="m-sleep" onclick="selectMood('sleep')">ğŸ˜´</span><div class="user-tag" id="tag-sleep"></div></div>
                <div class="mood-wrapper"><span class="mood-label">Mutlu</span><span class="mood-btn" id="m-happy" onclick="selectMood('happy')">ğŸ˜Š</span><div class="user-tag" id="tag-happy"></div></div>
                <div class="mood-wrapper"><span class="mood-label">Ders</span><span class="mood-btn" id="m-study" onclick="selectMood('study')">ğŸ“š</span><div class="user-tag" id="tag-study"></div></div>
                <div class="mood-wrapper"><span class="mood-label">MÃ¼zik</span><span class="mood-btn" id="m-music" onclick="selectMood('music')">ğŸ§</span><div class="user-tag" id="tag-music"></div></div>
                <div class="mood-wrapper"><span class="mood-label">Yorgun</span><span class="mood-btn" id="m-tired" onclick="selectMood('tired')">ğŸ˜«</span><div class="user-tag" id="tag-tired"></div></div>
                <div class="mood-wrapper"><span class="mood-label">DÄ±ÅŸarda</span><span class="mood-btn" id="m-out" onclick="selectMood('out')">â˜ï¸</span><div class="user-tag" id="tag-out"></div></div>
                <div class="mood-wrapper"><span class="mood-label">Yemek</span><span class="mood-btn" id="m-food" onclick="selectMood('food')">ğŸ•</span><div class="user-tag" id="tag-food"></div></div>
                <div class="mood-wrapper"><span class="mood-label">Dizi</span><span class="mood-btn" id="m-movie" onclick="selectMood('movie')">ğŸ¬</span><div class="user-tag" id="tag-movie"></div></div>
            </div>
        </div>

        <div class="main-panel">
            <div class="column-box">
                <h3>ğŸµ ÅarkÄ± PaylaÅŸÄ±mÄ±</h3>
                <div id="streakDisplay" style="background:#334155; color:white; border-radius:20px; padding:4px 12px; font-weight:bold; font-size:0.8rem; align-self:center; margin-bottom:15px;">GÃ¼ncel Seri ğŸ”¥ 3</div>
                <span class="slot-label" style="color:#ec4899;">ECEM</span>
                <div id="spotify-ecem" class="spotify-slot" onclick="copySong('ecem')">HenÃ¼z ÅŸarkÄ± eklenmedi.</div>
                <span class="slot-label" style="color:#3b82f6;">MELÄ°H</span>
                <div id="spotify-melih" class="spotify-slot" onclick="copySong('melih')">HenÃ¼z ÅŸarkÄ± eklenmedi.</div>
                <input type="text" id="songInput" placeholder="Spotify Linki YapÄ±ÅŸtÄ±r...">
                <button class="btn" style="background:#1db954;" onclick="updateSong()">PaylaÅŸ</button>
                <div class="scroll-area" id="songHistory" style="max-height: 100px;"></div>
            </div>

            <div class="column-box">
                <h3>ğŸ’¬ Sohbet</h3>
          <div class="chat-container">
                    <div class="chat-messages" id="chatBox"></div>
                    <div class="chat-input-row">
                        <button class="quick-msg-btn" onclick="toggleQuickMenu()">+</button>
                        <div class="quick-menu" id="quickMenu">
                            <div class="quick-item" onclick="sendQuick('GÃ¼naydÄ±nn â˜€ï¸')">GÃ¼naydÄ±n â˜€ï¸</div>
                            <div class="quick-item" onclick="sendQuick('Ä°yi geceler âœ¨')">Ä°yi geceler âœ¨</div>
                            <div class="quick-item" onclick="sendQuick('Naber? ğŸ˜Š')">Naber? ğŸ˜Š</div>
                            <div class="quick-item" onclick="sendQuick('Seni seviyorum â¤ï¸')">Seni seviyorum â¤ï¸</div>
                            <div class="quick-item" onclick="sendQuick('Ã–zledim.. ğŸ¥º')">Ã–zledim.. ğŸ¥º</div>
                            <div class="quick-item" onclick="sendQuick('MÃ¼sait misin?')">MÃ¼sait misin?</div>
                            <div class="quick-item" onclick="sendQuick('ArayayÄ±m mÄ±? ğŸ“')">ArayayÄ±m mÄ±? ğŸ“</div>
                            <div class="quick-item" onclick="sendQuick('Yemek yiyorum ğŸ•')">Yemek yiyorum ğŸ•</div>
                            <div class="quick-item" onclick="sendQuick('DÄ±ÅŸarÄ± Ã§Ä±kÄ±yorum â˜ï¸')">DÄ±ÅŸarÄ± Ã§Ä±kÄ±yorum â˜ï¸</div>
                            <div class="quick-item" onclick="sendQuick('Eve geldim âœ…')">Eve geldim âœ…</div>
                            <div class="quick-item" onclick="sendQuick('Uykum geldi ğŸ˜´')">Uykum geldi ğŸ˜´</div>
                            <div class="quick-item" onclick="sendQuick('Harika! ğŸŒŸ')">Harika! ğŸŒŸ</div>
                            <div class="quick-item" onclick="sendQuick('CanÄ±m sÄ±kÄ±ldÄ± ğŸ˜«')">CanÄ±m sÄ±kÄ±ldÄ± ğŸ˜«</div>
                            <div class="quick-item" onclick="sendQuick('Ders Ã§alÄ±ÅŸÄ±yorum ğŸ“š')">Ders Ã§alÄ±ÅŸÄ±yorum ğŸ“š</div>
                            <div class="quick-item" onclick="sendQuick('Oyun oynuyorum ğŸ®')">Oyun oynuyorum ğŸ®</div>
                            <div class="quick-item" onclick="sendQuick('ÅarkÄ± Ã§ok iyi! ğŸ§')">ÅarkÄ± Ã§ok iyi! ğŸ§</div>
                            <div class="quick-item" onclick="sendQuick('Birazdan gelirim')">Birazdan gelirim</div>
                            <div class="quick-item" onclick="sendQuick('Dikkat et kendine â¤ï¸')">Dikkat et â¤ï¸</div>
                            <div class="quick-item" onclick="sendQuick('Ellerine saÄŸlÄ±k ğŸ˜‹')">Eline saÄŸlÄ±k ğŸ˜‹</div>
                            <div class="quick-item" onclick="sendQuick('GÃ¶rÃ¼ÅŸÃ¼rÃ¼z ğŸ‘‹')">GÃ¶rÃ¼ÅŸÃ¼rÃ¼z ğŸ‘‹</div>
                        </div>
                        <input type="text" id="chatInput" placeholder="Mesaj yaz..." style="margin-bottom:0;" onkeypress="if(event.key==='Enter')sendChatMessage()">
                        <button class="btn" style="background:#10b981; width:60px;" onclick="sendChatMessage()">></button>
                    </div>
                </div>
            </div>

           <div class="column-box">
    <h3>ğŸ“ Ortak Notlar</h3>
    <input type="text" id="noteInput" placeholder="Bir ÅŸeyler yaz..." onkeypress="if(event.key==='Enter')sendNote()">
    <button class="btn" style="background:#3b82f6;" onclick="sendNote()">GÃ¶nder</button>
    <div class="scroll-area" id="noteList"></div> 
</div>

            <div class="column-box">
                <h3>ğŸ“ Planlar / Hedefler</h3>
                <input type="text" id="bucketInput" placeholder="Yeni bir plan ekle...">
                <button class="btn" style="background:#64748b;" onclick="addGoal()">Listeye Ekle</button>
                <div class="scroll-area" id="bucketList"></div>
            </div>
        </div>
  <div class="memory-card">
    <h2 style="text-align:center; color: #f43f5e; margin-bottom:15px;">ğŸ“¸ AnÄ± AkÄ±ÅŸÄ±</h2>
    
    <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 15px; margin-bottom: 20px;">
        <input type="text" id="memoryDesc" placeholder="AÃ§Ä±klama (Ä°steÄŸe baÄŸlÄ±)" style="width:100%; padding:10px; border-radius:8px; border:none; background:#0f172a; color:white; margin-bottom:8px; box-sizing: border-box;">
        <input type="text" id="memoryLink" placeholder="Veya FotoÄŸraf URL'si yapÄ±ÅŸtÄ±r..." style="width:100%; padding:10px; border-radius:8px; border:none; background:#0f172a; color:white; margin-bottom:8px; box-sizing: border-box;">
        
        <div style="display:flex; gap:8px;">
            <input type="file" id="memoryFile" accept="image/*" style="display:none;" onchange="updateFileName()">
            <button onclick="document.getElementById('memoryFile').click()" style="flex:1; background:#334155; color:white; border:none; padding:10px; border-radius:8px; cursor:pointer; font-size:12px;">ğŸ“ Dosya</button>
            <button onclick="saveMemory()" style="flex:1; background:#f43f5e; color:white; border:none; padding:10px; border-radius:8px; font-weight:bold; cursor:pointer;">GÃ¶nder</button>
        </div>
        <p id="fileNameDisplay" style="font-size: 10px; color: #94a3b8; margin-top: 8px; text-align:center;">Dosya seÃ§ilmedi</p>
    </div>

<div id="memoryGallery" class="memory-stream"></div>
</div>

        <div class="memory-card">
            <h2 style="text-align:center; color: #f43f5e; margin-bottom:15px;">ğŸ“¸ AnÄ± AkÄ±ÅŸÄ±</h2>
            <div id="memoryGallery" class="memory-stream"></div>
        </div>

        <div id="map"></div>
    </div> <div onclick="tamTemizlik()" style="position:fixed; bottom:0; right:0; width:50px; height:50px; cursor:pointer; z-index:999999; background:rgba(255,0,0,0.1); display:none;"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
       // ... Firebase ve JS kodlarÄ±n ...
    </script>
</body>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        
        // Firebase YapÄ±landÄ±rmasÄ± (GÃ¶rselinden alÄ±nan bilgiler)
const firebaseConfig = {
  apiKey: "AIzaSyC-RE1KJF-YQptezFsCdL3M-P7H4cH2SYA",
  authDomain: "melihx.firebaseapp.com",
  databaseURL: "https://melihx-default-rtdb.firebaseio.com",
  projectId: "melihx",
  storageBucket: "melihx.firebasestorage.app",
  messagingSenderId: "792501147254",
  appId: "1:792501147254:web:f4ad3b9a5e72c608adf157",
  measurementId: "G-YVT7PPL7ZQ"
};

// 1. Firebase BaÅŸlatma (Hata almamak iÃ§in kontrol ekliyoruz)
if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
}
const db = firebase.database();

// MESAJ GÃ–NDERME FONKSÄ°YONU
function sendChatMessage() {
    const input = document.getElementById('chatInput');
    const msg = input.value.trim();
    // Senin dosyanÄ±n geri kalanÄ±na uyumlu olmasÄ± iÃ§in active_user kullanÄ±yoruz
    const user = localStorage.getItem('active_user'); 

    if(!msg || !user) return;

    db.ref('chats').push({
        user: user,
        msg: msg,
        time: Date.now(),
        clock: new Date().toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' })
    });
    
    input.value = "";
}

// Ortak NotlarÄ± GÃ¼ncelle (Renkli ve Ã‡izgili GÃ¶rÃ¼nÃ¼m)
db.ref('notes').on('value', (snapshot) => {
    const noteList = document.getElementById('noteList');
    if(!noteList) return;
    noteList.innerHTML = "";
    snapshot.forEach((child) => {
        const data = child.val();
        const key = child.key;
        const div = document.createElement('div');
        
        // KullanÄ±cÄ±ya gÃ¶re renk ve stil belirleme
        const isEcem = data.user === 'ecem';
        const color = isEcem ? '#ec4899' : '#3b82f6'; // Pembe veya Mavi
        const bgColor = isEcem ? 'rgba(236, 72, 153, 0.1)' : 'rgba(59, 130, 246, 0.1)';

        div.className = "item-card";
        // Sol tarafa ince Ã§izgi ve arka plan rengi ekliyoruz
        div.style.borderLeft = `5px solid ${color}`;
        div.style.background = bgColor;
        div.style.marginBottom = "8px";
        div.style.padding = "10px";
        div.style.borderRadius = "8px";

        div.innerHTML = `
            <p style="margin: 0; color: white; font-weight: 500;">${data.mesaj}</p>
            <div style="font-size:10px; color:${color}; margin-top:5px; font-weight: bold;">
                ğŸ‘¤ ${data.user.toUpperCase()} - ğŸ“… ${data.tarih || new Date(data.time).toLocaleString('tr-TR')}
            </div>
        `;
        noteList.appendChild(div);
    });
});

// 3. ANILARI GÃœNCELLE (Silme yeri eklenmiÅŸ hali)
db.ref('memories').on('value', (snapshot) => {
    const gallery = document.getElementById('gallery');
    if(!gallery) return;
    gallery.innerHTML = "";
    snapshot.forEach((child) => {
        const data = child.val();
        const key = child.key;
        const div = document.createElement('div');
        div.className = "mem-bubble";
        div.innerHTML = `
            <button class="delete-item-btn" onclick="direktSil('memories', '${key}')">Ã—</button>
            <img src="${data.url}" style="width:100%; border-radius:12px; display:block;">
            ${data.description ? `<p style="margin-top:8px; font-size:14px; color:white;">${data.description}</p>` : ''}
        `;
        gallery.appendChild(div);
    });
});

// ... (Buradan sonra mevcut selectedUser, displayChats vb. fonksiyonlarÄ±n devam etmeli)
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx55yER9raJ_bJizwyZqU1IUcmRCnb-Do2oqfhokbLRxQQepMjf3x9V5RUy3htcsxgCcw/exec";
        let selectedUser = localStorage.getItem('active_user') || null;
        let lastSyncData = "";
        let mainMap = null;

        window.onload = function() {
    
            if (selectedUser) {
                document.getElementById('identityOverlay').classList.add('hidden');
                document.getElementById('step1').classList.remove('hidden');
                // Sayfa aÃ§Ä±lÄ±ÅŸÄ±nda her ÅŸeyi yÃ¼kle
                displayChats();
                displayLogs();
                displayGoals();
                loadSongs();
                displaySongHistory();
                updateMoodUI();
                updateStreakUI();
            }
            startBirthdayTimers();

        };        
async function updateWeather() {
    const locations = {
        ecem: { lat: 38.2312, lon: 27.9719, prefix: 'weather-ecem' },
        melih: { lat: 40.1885, lon: 29.0610, prefix: 'weather-melih' }
    };

    const weatherCodes = {
        0: { desc: "AÃ§Ä±k GÃ¶kyÃ¼zÃ¼", icon: "â˜€ï¸" },
        1: { desc: "Ã‡oÄŸunlukla AÃ§Ä±k", icon: "ğŸŒ¤ï¸" },
        2: { desc: "ParÃ§alÄ± Bulutlu", icon: "â›…" },
        3: { desc: "Bulutlu", icon: "â˜ï¸" },
        45: { desc: "Sisli", icon: "ğŸŒ«ï¸" },
        51: { desc: "Hafif Ã‡iseleme", icon: "ğŸŒ¦ï¸" },
        61: { desc: "Hafif YaÄŸmurlu", icon: "ğŸŒ§ï¸" },
        63: { desc: "YaÄŸmurlu", icon: "ğŸŒ§ï¸" },
        71: { desc: "Hafif KarlÄ±", icon: "â„ï¸" },
        95: { desc: "FÄ±rtÄ±na", icon: "âš¡" }
    };

    for (let person in locations) {
        try {
            const loc = locations[person];
            const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${loc.lat}&longitude=${loc.lon}&current_weather=true&timezone=auto`);
            const data = await res.json();
            
            const temp = Math.round(data.current_weather.temperature);
            const code = data.current_weather.weathercode;
            const info = weatherCodes[code] || { desc: "Bulutlu", icon: "â˜ï¸" };

            // Derece ve Ä°kon (Ãœst SatÄ±r)
            document.getElementById(`${loc.prefix}-main`).innerHTML = `${info.icon} ${temp}Â°C`;
            // Hava Durumu Metni (Alt SatÄ±r)
            document.getElementById(`${loc.prefix}-desc`).innerHTML = info.desc;
            
        } catch (e) {
            console.log("Hava durumu hatasÄ±");
        }
    }
}
function showLoveWord() {
    const words = [
        "Sen benim baÅŸÄ±ma gelen en gÃ¼zel ÅŸeysin. âœ¨", "Kalbimin tek sahibi sensin. â¤ï¸", "GÃ¶zlerinde dÃ¼nyayÄ± gÃ¶rÃ¼yorum. ğŸŒ",
        "Seni sevmek nefes almak gibi. ğŸŒ¬ï¸", "Ä°yi ki varsÄ±n sevgilim. ğŸ¥°", "Ruhumun eÅŸi sensin. ğŸ’", "Sen benim mucizemsin. ğŸª„",
        "GÃ¼lÃ¼ÅŸÃ¼n dÃ¼nyaya gÃ¼neÅŸ gibi doÄŸuyor. â˜€ï¸", "Sen benim evimsin. ğŸ¡", "HayatÄ±mÄ±n anlamÄ± sensin. ğŸ¯",
        "Seni her gÃ¼n bir Ã¶ncekinden daha Ã§ok seviyorum. ğŸ“ˆ", "Seninle geÃ§en her saniye bir hazine. ğŸ’",
        "Ellerini hiÃ§ bÄ±rakmak istemiyorum. ğŸ¤", "Sen benim ÅŸansÄ±msÄ±n. ğŸ€", "DÃ¼nyadaki en gÃ¼zel manzara senin yÃ¼zÃ¼n. ğŸ–¼ï¸",
        "Sen benim en tatlÄ± uykumsun. ğŸ’¤", "Kalbimin her kÃ¶ÅŸesi seninle dolu. ğŸ’–", "Seninle yaÅŸlanmak tek hayalim. ğŸ‘´ğŸ‘µ",
        "BakÄ±ÅŸlarÄ±nda kaybolmak istiyorum. ğŸŒŠ", "Sen benim huzurumsun. ğŸ§˜", "AÅŸkÄ±mÄ±z sonsuz olsun. â™¾ï¸",
        "Seninle her yer cennet bana. ğŸï¸", "Kalbim sadece senin iÃ§in atÄ±yor. ğŸ’“", "Sesin ruhuma en iyi gelen ilaÃ§. ğŸ’Š",
        "Sen benim gÃ¶kyÃ¼zÃ¼ndeki en parlak yÄ±ldÄ±zÄ±msÄ±n. â­", "VarlÄ±ÄŸÄ±n bana gÃ¼Ã§ veriyor. ğŸ’ª", "Sana olan sevgim kelimelere sÄ±ÄŸmÄ±yor. ğŸ“š",
        "Sen benim en gÃ¼zel rÃ¼yamÄ±n gerÃ§eÄŸe dÃ¶nÃ¼ÅŸmÃ¼ÅŸ halisin. ğŸ’­", "AÅŸkÄ±n beni her gÃ¼n yeniden doÄŸuruyor. ğŸ£",
        "Seni dÃ¼ÅŸÃ¼nmeden geÃ§en bir saniyem bile yok. â³", "HayatÄ±mÄ±n tÃ¼m renkleri seninle geldi. ğŸŒˆ",
        "Sen benim kahramanÄ±msÄ±n. ğŸ¦¸â€â™‚ï¸", "YanÄ±nda olduÄŸum her an kendimi buluyorum. ğŸ§©", "AÅŸkÄ±mÄ±z bir masal gibi. ğŸ“–",
        "Sana sarÄ±lmak dÃ¼nyadaki en gÃ¼venli yer. ğŸ«‚", "Kalbim seninle atÄ±yor, seninle duracak. ğŸ›‘",
        "Sen benim sonsuzluÄŸumsun. ğŸŒŒ", "GÃ¼zelliÄŸin karÅŸÄ±sÄ±nda bÃ¼yÃ¼leniyorum. ğŸ¤©", "Seninle her zorluk bir oyun gibi. ğŸ®",
        "Sen benim dualarÄ±mÄ±n cevabÄ±sÄ±n. ğŸ™", "AÅŸkÄ±n iÃ§imde bir kor gibi yanÄ±yor. ğŸ”¥", "Sen benim ruh eÅŸimsin. ğŸ”¥",
        "DÃ¼nyanÄ±n en ÅŸanslÄ± insanÄ±yÄ±m Ã§Ã¼nkÃ¼ seninleyim. ğŸ°", "Sen benim yaÅŸama sevincimsin. ğŸŒ±",
        "Her sabah seninle uyanma fikri bile huzur verici. â˜•", "Sen benim kalbimdeki en derin izsin. ğŸ‘£",
        "Seni sevmekten asla vazgeÃ§meyeceÄŸim. ğŸ›¡ï¸", "Sen benim bir tanemsin. â˜ï¸", "HayatÄ±ma dokunduÄŸun an her ÅŸey gÃ¼zelleÅŸti. ğŸª„",
        "Seninle her anÄ±m bir Ã¶mre bedel. â³", "AÅŸkÄ±n benim pusulam. ğŸ§­", "Sen benim her ÅŸeyimsin. ğŸ—ï¸",
        "GÃ¶zlerindeki Ä±ÅŸÄ±k yolumu aydÄ±nlatÄ±yor. ğŸ’¡", "Seninle gÃ¼lmek en bÃ¼yÃ¼k mutluluÄŸum. ğŸ˜‚",
        "Sen benim en gÃ¼zel ÅŸiirimsin. âœï¸", "Kalbimin ritmini deÄŸiÅŸtiren tek sensin. ğŸ¥",
        "Seni sevmek hayatÄ±mÄ±n en doÄŸru kararÄ±. âœ…", "Sen benim nefesimsin. ğŸ’¨", "Seninle olmak bir rÃ¼ya gibi. â˜ï¸",
        "Hayallerimin Ã¶tesindeki sevgilimsin. ğŸš€", "AÅŸkÄ±n bana her ÅŸeyi unutturuyor. ğŸ§ ",
        "Sen benim bitmeyen ÅŸarkÄ±msÄ±n. ğŸ¶", "Seninle geÃ§en Ã¶mÃ¼r en bÃ¼yÃ¼k Ã¶dÃ¼lÃ¼m. ğŸ†",
        "Sen benim dÃ¼nyamsÄ±n. ğŸ—ºï¸", "GÃ¼lÃ¼ÅŸÃ¼nde huzur bulduÄŸum tek insansÄ±n. ğŸ˜Š", "Sana olan aÅŸkÄ±m her an katlanÄ±yor. ğŸ“‚",
        "Sen benim en kÄ±ymetlimsin. ğŸ‘‘", "HayatÄ±mÄ±n en gÃ¼zel hikayesi seninle baÅŸladÄ±. ğŸ¬",
        "Sen benim ruhumun aynasÄ±sÄ±n. ğŸª", "Seni her halinle seviyorum. ğŸ’¯", "Sen benim canÄ±msÄ±n. ğŸ©¸",
        "YanÄ±nda zaman dursun istiyorum. â±ï¸", "AÅŸkÄ±n kalbimde Ã§iÃ§ekler aÃ§tÄ±rÄ±yor. ğŸŒ¸",
        "Sen benim sol yanÄ±m, en gÃ¼zel yanÄ±msÄ±n. ğŸ‘ˆ", "DÃ¼nyayÄ± seninle keÅŸfetmek istiyorum. ğŸŒ",
        "Sen benim en bÃ¼yÃ¼k aÅŸkÄ±msÄ±n. ğŸ³", "Seni dÃ¼ÅŸÃ¼nmek bile iÃ§imi Ä±sÄ±tÄ±yor. ğŸ§£",
        "Sen benim cennetimsin. ğŸ‘¼", "Kalbimdeki yerin asla dolmayacak. ğŸ•³ï¸", "Sen benim hayat Ä±ÅŸÄ±ÄŸÄ±msÄ±n. ğŸ”¦",
        "Seni sevmek bir ayrÄ±calÄ±k. ğŸ«", "Seninle her ÅŸey mÃ¼mkÃ¼n. ğŸŒŸ", "Sen benim can yoldaÅŸÄ±msÄ±n. ğŸ‘¯",
        "AÅŸkÄ±n beni tamamlÄ±yor. ğŸŒ“", "Sen benim en gÃ¼zel gerÃ§eÄŸimsin. ğŸ¦„", "Seninle bir Ã¶mÃ¼r yetmez bana. â™¾ï¸",
        "Sen benim tek gerÃ§eÄŸimsin. ğŸ“", "AÅŸkÄ±nla dÃ¼nyam deÄŸiÅŸti. ğŸŒ", "Sen benim baharÄ±msÄ±n. ğŸŒ·",
        "Seni sevmek en gÃ¼zel duygu. ğŸ§¸", "Sen benim hayatÄ±mÄ±n baÅŸrolÃ¼sÃ¼n. ğŸ­", "Seninle her ÅŸey daha anlamlÄ±. ğŸ•¯ï¸",
        "AÅŸkÄ±n iÃ§imi titretiyor. ğŸ’“", "Sen benim her halimsin. â˜¯ï¸", "Seni Ã§ok seviyorum. ğŸ’",
        "Sen benim Ã¶mrÃ¼msÃ¼n. ğŸ•°ï¸", "Seninle her gÃ¼n yeni bir macera. ğŸ›¶", "AÅŸkÄ±mÄ±z Ã¶lÃ¼msÃ¼z olsun. ğŸ§›â€â™‚ï¸â¤ï¸",
        "Sen benim kalbimdir. ğŸ«€", "Seni seviyorum, hem de Ã§ok. ğŸ’–âœ¨"
    ];

    const randomIndex = Math.floor(Math.random() * words.length);
    const display = document.getElementById('love-text-display');
    
    // MesajÄ± Kutuda GÃ¶ster
    if(display) {
        display.style.opacity = '0';
        setTimeout(() => {
            display.innerText = words[randomIndex];
            display.style.opacity = '1';
        }, 200);
    }

    // KONFETÄ°LERÄ° PATLAT
    createConfetti();
}

function createConfetti() {
    const colors = ['#ec4899', '#db2777', '#f472b6', '#ffffff', '#ffd700'];
    const shapes = ['â¤ï¸', 'âœ¨', 'ğŸ’–', 'â­', 'ğŸŒ¸'];

    for (let i = 0; i < 35; i++) {
        const confetti = document.createElement('div');
        confetti.innerText = shapes[Math.floor(Math.random() * shapes.length)];
        confetti.style.position = 'fixed';
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.top = '-5vh';
        confetti.style.color = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.fontSize = (Math.random() * 15 + 15) + 'px';
        confetti.style.zIndex = '10001';
        confetti.style.pointerEvents = 'none';
        confetti.style.transition = `transform ${Math.random() * 2 + 3}s linear, opacity ${Math.random() * 2 + 3}s linear`;
        
        document.body.appendChild(confetti);

        setTimeout(() => {
            confetti.style.transform = `translateY(110vh) translateX(${Math.random() * 200 - 100}px) rotate(${Math.random() * 360}deg)`;
            confetti.style.opacity = '0';
        }, 10);

        setTimeout(() => { confetti.remove(); }, 5000);
    }
}

        function initMap() {
            if (mainMap) return;
            mainMap = L.map('map', { zoomControl: false }).setView([39.2, 28.5], 7);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(mainMap);
            const bursa = [40.1885, 29.0610];
            const odemis = [38.2312, 27.9719]; 
            L.marker(bursa).addTo(mainMap).bindPopup('<b>Melih</b><br>Bursa ğŸ‚');
            L.marker(odemis).addTo(mainMap).bindPopup('<b>Ecem</b><br>Ã–demiÅŸ ğŸº');
            const midLat = (bursa[0] + odemis[0]) / 2 + 0.5;
            const midLon = (bursa[1] + odemis[1]) / 2 + 0.2;
            L.polyline([bursa, [midLat, midLon], odemis], { color: '#3b82f6', weight: 3, opacity: 0.7, dashArray: '10, 10' }).addTo(mainMap);
            const heartIcon = L.divIcon({ className: 'custom-div-icon', html: `<div style="text-align: center;"><span class="beating-heart">â¤ï¸</span><br><span class="map-label">369 KM</span></div>`, iconSize: [80, 60], iconAnchor: [40, 30] });
            L.marker([midLat, midLon], { icon: heartIcon }).addTo(mainMap);
        }

 async function syncVeri() {
    try {
        // 't=' parametresi Google'Ä±n eski veriyi (cache) vermesini engeller, hÄ±zÄ± artÄ±rÄ±r
        const response = await fetch(SCRIPT_URL + "?action=read&t=" + new Date().getTime());
        const remoteData = await response.json();
        
        if(!remoteData) return;

        const stringified = JSON.stringify(remoteData);
        // Veri deÄŸiÅŸmediyse boÅŸuna ekranÄ± yenileyip tarayÄ±cÄ±yÄ± yorma
        if(stringified === lastSyncData) return;
        lastSyncData = stringified;
        
        // NOTLAR GÃœNCELLE
        if(remoteData.notes) { 
            localStorage.setItem('notes', JSON.stringify(remoteData.notes)); 
            displayLogs(); 
        }

        // PLANLAR GÃœNCELLE
        if(remoteData.goals) { 
            localStorage.setItem('goals', JSON.stringify(remoteData.goals)); 
            displayGoals(); 
        }

        // SOHBET GÃœNCELLE
        if(remoteData.chats) { 
            localStorage.setItem('chats', JSON.stringify(remoteData.chats)); 
            displayChats(); 
        }

        // ÅARKILAR GÃœNCELLE
        if(remoteData.songs) {
            localStorage.setItem('song_history', JSON.stringify(remoteData.songs));
            remoteData.songs.forEach(s => { 
                if(s.user && s.link) localStorage.setItem('song_' + s.user, s.link); 
            });
            loadSongs();
            displaySongHistory();
        }

        // MODLAR GÃœNCELLE
        if(remoteData.moods) {
            const now = new Date().getTime();
            remoteData.moods.forEach(m => { 
                const localTime = parseInt(localStorage.getItem('mood_time_' + m.user)) || 0;
                // Sadece daha yeni olan mod bilgisini iÅŸle
                if(m.mood && m.time >= localTime) { 
                    localStorage.setItem('mood_' + m.user, m.mood); 
                    localStorage.setItem('mood_time_' + m.user, m.time); 
                }
            });
            updateMoodUI();
        }
    } catch(e) { 
        console.warn("Senkronizasyon bekleniyor..."); 
    }
}

        function toggleQuickMenu() {
            const menu = document.getElementById('quickMenu');
            menu.style.display = menu.style.display === 'grid' ? 'none' : 'grid';
        }

        function sendQuick(msg) {
            document.getElementById('chatInput').value = msg;
            sendChatMessage();
            toggleQuickMenu();
        }

function sendChatMessage() {
    const val = document.getElementById('chatInput').value.trim();
    if(!val || !selectedUser) return;

    const chatBox = document.getElementById('chatBox');
    const now = Date.now(); 
    const timeStr = new Date().toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' }); // "22:15" gibi
    const msgId = "msg-" + now;

    // 1. ADIM: Ekrana ANINDA bas (Tarih eklendi)
    const tempHtml = `
        <div class="msg msg-${selectedUser}" id="${msgId}">
            ${val}
            <div style="font-size: 8px; opacity: 0.7; margin-top: 4px; text-align: right;">${timeStr}</div>
        </div>`;
    chatBox.innerHTML += tempHtml;
    chatBox.scrollTop = chatBox.scrollHeight;
    
    document.getElementById('chatInput').value = "";

    // 2. ADIM: Firebase'e gÃ¶nder (Zaman bilgisini de ekledik)
    db.ref('chats').push({
        user: selectedUser,
        msg: val,
        time: now,
        clock: timeStr // Saat bilgisini buraya ekledik
    });

    setTimeout(() => {
        if(typeof sendToExcel === "function") sendToExcel(val, "Chat");
    }, 2000);
}

        function setUser(name) {
            selectedUser = name;
            localStorage.setItem('active_user', name);
            document.getElementById('identityOverlay').style.display = 'none';
            document.getElementById('step1').classList.remove('hidden');
            sendToExcel("Sisteme GiriÅŸ YaptÄ±", "Log");
            displayChats();
            displayLogs();
            displayGoals();
            loadSongs();
        }
function sendToExcel(mesaj, tip, ekVeri = "") {
    const entry = { user: selectedUser, tip: tip, mesaj: mesaj, ek: ekVeri };
    
    // FETCH isteÄŸini gÃ¼ncelledik
    fetch(SCRIPT_URL, {
        method: 'POST',
        body: JSON.stringify(entry)
    }).then(() => {
        console.log("Veri baÅŸarÄ±yla buluta gÃ¶nderildi.");
    }).catch(err => console.error("GÃ¶nderim hatasÄ±:", err));
}

        function startReset() {
            document.getElementById('step1').classList.add('hidden');
            const term = document.getElementById('terminal');
            term.classList.remove('hidden');
            const lines = ["> BaÄŸlantÄ± kuruluyor...", "> Veriler senkronize ediliyor...", "> Sistem hazÄ±r."];
            let i = 0;
            const intv = setInterval(() => {
                if(i < lines.length) { term.innerHTML += lines[i]+"<br>"; i++; }
                else { clearInterval(intv); setTimeout(() => { term.classList.add('hidden'); document.getElementById('step3').classList.remove('hidden'); initMap(); }, 800); }
            }, 600);
        }

        function startBirthdayTimers() {
        // 225. satÄ±r civarÄ±
updateWeather(); 
setInterval(updateWeather, 900000); // 15 dakikada bir otomatik gÃ¼nceller
            function updateTimer(targetMonth, targetDay, elementId) {
                const now = new Date(); let year = now.getFullYear();
                let bday = new Date(year, targetMonth - 1, targetDay);
                if (now > bday) bday = new Date(year + 1, targetMonth - 1, targetDay);
                const diff = bday - now;
                const d = Math.floor(diff / 86400000);
                const h = Math.floor((diff % 86400000) / 3600000);
                const m = Math.floor((diff % 3600000) / 60000);
                const s = Math.floor((diff % 60000) / 1000);
                document.getElementById(elementId).innerText = `${d}g ${h}s ${m}d ${s}s`;
            }
            setInterval(() => { updateTimer(8, 12, 'ecemTimer'); updateTimer(6, 7, 'melihTimer'); }, 1000);
        }

     function selectMood(moodId) {
    const user = localStorage.getItem('active_user');
    if(!user) { alert("LÃ¼tfen Ã¶nce giriÅŸ yapÄ±n!"); return; }
    // Firebase'e mod gÃ¶nderiyoruz
    db.ref('moods/' + user).set({
        mood: moodId,
        time: Date.now()
    });
}

        function updateMoodUI() {
            document.querySelectorAll('.mood-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.user-tag').forEach(tag => tag.innerHTML = "");
            const now = new Date().getTime();
            const limit = 86400000;
            ['ecem', 'melih'].forEach(u => {
                const m = localStorage.getItem('mood_' + u);
                const t = localStorage.getItem('mood_time_' + u);
                if(m && t && (now - t < limit)) { 
                    document.getElementById('m-' + m)?.classList.add('active');
                    const tag = document.getElementById('tag-' + m);
                    if(tag) tag.innerHTML += `<span class="${u === 'ecem' ? 'tag-e' : 'tag-m'}">${u}</span>`;
                }
            });
        }

        function updateStreakUI() {
            let streak = parseInt(localStorage.getItem('song_streak')) || 3;
            document.getElementById('streakDisplay').innerText = `GÃ¼ncel Seri ğŸ”¥ ${streak}`;
        }

        function updateSong() {
            const val = document.getElementById('songInput').value;
            if(!val.includes("track")) return;
            
            const now = new Date();
            const todayStr = now.toDateString(); 
            const lastUpdateDate = localStorage.getItem('last_song_date');
            let streak = parseInt(localStorage.getItem('song_streak')) || 3;

            if (lastUpdateDate !== todayStr) {
                streak++;
                localStorage.setItem('song_streak', streak);
                localStorage.setItem('last_song_date', todayStr);
                updateStreakUI();
            }

            localStorage.setItem('song_' + selectedUser, val);
            loadSongs();
            document.getElementById('songInput').value = "";
            sendToExcel(val, "ÅarkÄ±", streak);
        }

        function loadSongs() {
            ['ecem', 'melih'].forEach(u => {
                const song = localStorage.getItem('song_' + u);
                const slot = document.getElementById('spotify-' + u);
                if(song && slot) {
                    const parts = song.split("track/");
                    if(parts.length > 1) {
                        const sid = parts[1].split("?")[0];
                        slot.innerHTML = `<iframe src="https://open.spotify.com/embed/track/${sid}" width="100%" height="80" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>`;
                    }
                }
            });
        }

        function displaySongHistory() {
            const history = JSON.parse(localStorage.getItem('song_history')) || [];
            const container = document.getElementById('songHistory');
            if(container) {
                container.innerHTML = history.slice(0, 5).map(s => `<div class="song-history-item" onclick="window.open('${s.link}', '_blank')">ğŸµ ${s.user.toUpperCase()} paylaÅŸtÄ±...</div>`).join('');
            }
        }
function sendNote() {
    const val = document.getElementById('noteInput').value.trim();
    if(!val || !selectedUser) return;
    
    db.ref('notes').push({
        user: selectedUser,
        mesaj: val,
        time: Date.now(),
        tarih: new Date().toLocaleString('tr-TR')
    });
    
    document.getElementById('noteInput').value = "";
}

        function displayLogs() {
            const logs = JSON.parse(localStorage.getItem('notes')) || [];
            const logList = document.getElementById('logList');
            if(logList) {
                logList.innerHTML = logs.map(l => `<div class="item-card"><b>${l.mesaj}</b> <span style="color:${l.user === 'ecem' ? '#ec4899' : '#3b82f6'}; font-size:0.75rem;">(${l.user})</span></div>`).join('');
            }
        }

        function addGoal() {
            const val = document.getElementById('bucketInput').value;
            if(!val) return;
            const entry = { text: val, done: false, user: selectedUser };
            const goals = JSON.parse(localStorage.getItem('goals')) || [];
            goals.push(entry);
            localStorage.setItem('goals', JSON.stringify(goals));
            document.getElementById('bucketInput').value = "";
            displayGoals();
            sendToExcel(val, "Hedef");
        }

        function displayGoals() {
            const goals = JSON.parse(localStorage.getItem('goals')) || [];
            const bucketList = document.getElementById('bucketList');
            if(bucketList) {
                bucketList.innerHTML = goals.map((g, i) => `<div class="item-card"><input type="checkbox" ${g.done ? 'checked' : ''} onclick="toggleGoal(${i})"> ${g.text}</div>`).join('');
            }
        }

        function toggleGoal(i) {
            const goals = JSON.parse(localStorage.getItem('goals'));
            goals[i].done = !goals[i].done;
            localStorage.setItem('goals', JSON.stringify(goals));
            displayGoals();
            sendToExcel(goals[i].text, "Hedef-Tamamla", goals[i].done);
        }

        function copySong(u) {
            const song = localStorage.getItem('song_' + u);
            if(song) { navigator.clipboard.writeText(song); alert(`KopyalandÄ±!`); }
        }

function adminSisteminiAc() {
    let id = prompt("ID Girin:");
    let sifre = prompt("Åifre Girin:");

    if (id === "melih" && sifre === "9999") {
        let islem = prompt("Ne yapmak istiyorsun?\n1: Ã‡arpÄ±larÄ± AÃ§/Kapat\n2: HER ÅEYÄ° SÄ°L (TOPLU)");

        if (islem === "1") {
            // Ã‡arpÄ± iÅŸaretlerini gÃ¶sterir veya gizler
            document.body.classList.toggle('admin-active');
            alert("DÃ¼zenleme modu deÄŸiÅŸtirildi.");
        } 
        else if (islem === "2") {
            // Toplu silme
            if (confirm("DÄ°KKAT! Her ÅŸey silinecek. Emin misin?")) {
                const refRoot = firebase.database().ref();
                Promise.all([
                    refRoot.child('chats').remove(),
                    refRoot.child('notes').remove(),
                    refRoot.child('memories').remove()
                ]).then(() => {
                    alert("VeritabanÄ± sÄ±fÄ±rlandÄ±.");
                    location.reload();
                });
            }
        }
    } else {
        alert("HatalÄ± giriÅŸ!");
    }
}

// Tekli silme fonksiyonu (Ã‡arpÄ±lara basÄ±nca Ã§alÄ±ÅŸÄ±r)
function directDelete(path, key) {
    firebase.database().ref(path).child(key).remove()
    .then(() => console.log("Silindi"))
    .catch(e => alert("Hata: " + e.message));
}

// 2. SEVGÄ° SAYACI FONKSÄ°YONU
function sendLoveClick() {
    showLoveWord(); // Mevcut konfeti ve mesaj fonksiyonun
    sendToExcel("Kalp AtÄ±ÅŸÄ±", "Sevgi_Click"); 
}

// 3. AKTÄ°FLÄ°K VE SÃœRE TAKÄ°BÄ°
function updateMyStatus(status) {
    sendToExcel(status, "Status_Update");
}

// Sayfa aÃ§Ä±ldÄ±ÄŸÄ±nda aktif yap
window.addEventListener('load', () => {
    updateMyStatus("Aktif ğŸŸ¢");
});

// Sayfa kapatÄ±ldÄ±ÄŸÄ±nda sÃ¼re hesapla ve deaktif yap
window.addEventListener('beforeunload', () => {
    let duration = Math.round((Date.now() - startTime) / 60000);
    sendToExcel(`${duration} dk durdu`, "Session_End");
    updateMyStatus("Deaktif ğŸ”´");
});

// 4. VERÄ°LERÄ° EKRANA BASAN syncVeri GÃœNCELLEMESÄ°
async function syncVeri() {
    try {
        const response = await fetch(SCRIPT_URL + "?action=read&t=" + Date.now());
        const remoteData = await response.json();
        if(!remoteData) return;

        // Sevgi Ä°statistiklerini GÃ¼ncelle
        if(remoteData.loveStats) {
            document.getElementById('love-stats').innerHTML = 
                `Ecem: ${remoteData.loveStats.ecem || 0} â¤ï¸ Melih: ${remoteData.loveStats.melih || 0}`;
        }

        // Aktiflik DurumlarÄ±nÄ± GÃ¼ncelle
        if(remoteData.userStatus) {
            document.getElementById('status-ecem').innerText = remoteData.userStatus.ecem || "Bilinmiyor";
            document.getElementById('status-melih').innerText = remoteData.userStatus.melih || "Bilinmiyor";
        }

        const stringified = JSON.stringify(remoteData);
        if(stringified === lastSyncData) return;
        lastSyncData = stringified;

        // DiÄŸer mevcut gÃ¼ncellemelerin (Chat, Notlar vb.) aynen devam etsin...
        if(remoteData.chats) { localStorage.setItem('chats', JSON.stringify(remoteData.chats)); displayChats(); }
        if(remoteData.notes) { localStorage.setItem('notes', JSON.stringify(remoteData.notes)); displayLogs(); }
        // ...
    } catch(e) { console.warn("Yenileniyor..."); }
}

// --- OTOMATÄ°K BUTON EKLEME SÄ°STEMÄ° ---

// Sohbetler iÃ§in
const originalDisplayChats = window.displayChats;
window.displayChats = function() {
    if(typeof originalDisplayChats === "function") originalDisplayChats();
    if(document.body.classList.contains('admin-active')) {
        document.querySelectorAll('.msg').forEach((msg, i) => {
            if(!msg.querySelector('.admin-del')) {
                const btn = document.createElement('button');
                btn.innerHTML = 'Ã—';
                btn.className = 'admin-del';
                btn.style = "background:#ff4d4d; color:white; border:none; border-radius:4px; width:18px; height:18px; cursor:pointer; float:right; font-weight:bold; margin-left:5px;";
                btn.onclick = (e) => { e.stopPropagation(); deleteItem('chats', i, displayChats); };
                msg.prepend(btn);
            }
        });
    }
};

// Notlar (Loglar) iÃ§in
const originalDisplayLogs = window.displayLogs;
window.displayLogs = function() {
    if(typeof originalDisplayLogs === "function") originalDisplayLogs();
    if(document.body.classList.contains('admin-active')) {
        document.querySelectorAll('#logList .item-card').forEach((item, i) => {
            if(!item.querySelector('.admin-del')) {
                const btn = document.createElement('button');
                btn.innerHTML = 'SÄ°L';
                btn.className = 'admin-del';
                btn.style = "background:#ff4d4d; color:white; border:none; border-radius:4px; padding:2px 8px; cursor:pointer; float:right; font-size:10px; font-weight:bold;";
                btn.onclick = (e) => { e.stopPropagation(); deleteItem('notes', i, displayLogs); };
                item.prepend(btn);
            }
        });
    }
};

// Planlar (Hedefler) iÃ§in
const originalDisplayGoals = window.displayGoals;
window.displayGoals = function() {
    if(typeof originalDisplayGoals === "function") originalDisplayGoals();
    if(document.body.classList.contains('admin-active')) {
        document.querySelectorAll('#bucketList .item-card').forEach((item, i) => {
            if(!item.querySelector('.admin-del')) {
                const btn = document.createElement('button');
                btn.innerHTML = 'SÄ°L';
                btn.className = 'admin-del';
                btn.style = "background:#ff4d4d; color:white; border:none; border-radius:4px; padding:2px 8px; cursor:pointer; float:right; font-size:10px; font-weight:bold;";
                btn.onclick = (e) => { e.stopPropagation(); deleteItem('goals', i, displayGoals); };
                item.prepend(btn);
            }
        });
    }
};
function updateFileName() {
    const input = document.getElementById('memoryFile');
    const display = document.getElementById('fileNameDisplay');
    if (input.files.length > 0) display.innerText = "âœ… " + input.files[0].name;
}

function saveMemory() {
    const desc = document.getElementById('memoryDesc').value;
    const link = document.getElementById('memoryLink').value;
    const file = document.getElementById('memoryFile').files[0];

    if (!selectedUser) { alert("Kim olduÄŸunuzu seÃ§in!"); return; }
    if (!file && !link) { alert("FotoÄŸraf seÃ§in veya URL girin!"); return; }

    const memoryData = {
        user: selectedUser,
        description: desc || "",
        date: new Date().toLocaleString('tr-TR'),
        timestamp: Date.now()
    };

    const finalizeAndPush = (imgData) => {
        memoryData.image = imgData;
        db.ref('memories').push(memoryData).then(() => {
            document.getElementById('memoryDesc').value = "";
            document.getElementById('memoryLink').value = "";
            document.getElementById('memoryFile').value = "";
            document.getElementById('fileNameDisplay').innerText = "Dosya seÃ§ilmedi";
        });
    };

    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const img = new Image();
            img.src = e.target.result;
            img.onload = function() {
                const canvas = document.createElement('canvas');
                const MAX_WIDTH = 600; // 2'li gÃ¶rÃ¼nÃ¼m iÃ§in 600px yeterli
                const scaleSize = MAX_WIDTH / img.width;
                canvas.width = MAX_WIDTH;
                canvas.height = img.height * scaleSize;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                finalizeAndPush(canvas.toDataURL('image/jpeg', 0.6));
            };
        };
        reader.readAsDataURL(file);
    } else {
        finalizeAndPush(link);
    }
}

db.ref('memories').on('value', (snapshot) => {
    const gallery = document.getElementById('memoryGallery');
    if(!gallery) return;
    gallery.innerHTML = "";
    const data = snapshot.val();
    if (data) {
        // En yeni anÄ± en Ã¼stte gÃ¶rÃ¼nsÃ¼n
        Object.values(data).sort((a,b) => b.timestamp - a.timestamp).forEach(mem => {
            const div = document.createElement('div');
            // Kimin gÃ¶nderdiÄŸine gÃ¶re Ã¶zel sÄ±nÄ±f ekliyoruz
            div.className = `mem-bubble mem-${mem.user}`;
            div.innerHTML = `
                <img src="${mem.image}" class="mem-img" onclick="const w=window.open(); w.document.write('<img src='+this.src+' style=width:100%>');"
                <div class="mem-footer" style="margin-top: 10px;">
                    ${mem.description ? `<p class="mem-text" style="margin: 0 0 8px 0; color: #f1f5f9; font-size: 15px;">${mem.description}</p>` : ''}
                    <div style="display: flex; justify-content: space-between; align-items: center; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 8px;">
                        <span class="mem-user-name" style="font-weight: bold; font-size: 12px; color: #f43f5e;">ğŸ‘¤ ${mem.user}</span>
                        <span class="mem-time" style="color: #64748b; font-size: 10px;">ğŸ“… ${mem.date}</span>
                    </div>
                </div>
            `;
            gallery.appendChild(div);
        });
    }
});
// Onay sormadan direkt silen merkezi fonksiyon
function direktSil(path, key) {
    db.ref(path).child(key).remove()
    .then(() => {
        console.log(path + " iÃ§inden bir Ã¶ÄŸe baÅŸarÄ±yla silindi.");
    })
    .catch((error) => {
        console.error("Silme hatasÄ±:", error);
    });
}
// MODLARI ANLIK GÃœNCELLE
db.ref('moods').on('value', (snapshot) => {
    document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.user-tag').forEach(t => t.innerHTML = "");
    snapshot.forEach(child => {
        const u = child.key; const d = child.val();
        if(d && (Date.now() - d.time < 86400000)) {
            const btn = document.getElementById('m-'+d.mood);
            if(btn) btn.classList.add('active');
            const tag = document.getElementById('tag-'+d.mood);
            if(tag) {
                const color = u === 'ecem' ? '#ec4899' : '#3b82f6';
                tag.innerHTML += `<span style="color:${color}; font-weight:bold; font-size:10px; margin-right:5px;">${u.toUpperCase()}</span>`;
            }
        }
    });
});

// CHAT GÃ–NDERME FONKSÄ°YONU
function sendChatMessage() {
    const input = document.getElementById('chatInput');
    const user = localStorage.getItem('active_user');
    if(!input.value.trim() || !user) return;
    db.ref('chats').push({
        user: user,
        msg: input.value,
        time: Date.now(),
        clock: new Date().toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' })
    });
    input.value = "";
}
// MESAJLARI EKRANA BASAN TEK VE ASIL FONKSÄ°YON
db.ref('chats').limitToLast(20).on('child_added', (snapshot) => {
    const data = snapshot.val();
    const key = snapshot.key; // MesajÄ±n benzersiz kimliÄŸi
    const chatBox = document.getElementById('chatBox');
    
    if(chatBox) {
        // EÄŸer mesaj zaten ekrandaysa (ID kontrolÃ¼), tekrar ekleme!
        if(document.getElementById('msg-' + key)) return;

        const div = document.createElement('div');
        div.id = 'msg-' + key; // Her mesaja benzersiz ID veriyoruz
        div.className = `msg msg-${data.user}`;
        div.style.padding = "8px 12px";
        div.style.borderRadius = "10px";
        div.style.maxWidth = "80%";
        div.style.color = "white";
        div.style.marginBottom = "5px";
        div.style.background = data.user === 'ecem' ? '#ec4899' : '#3b82f6';
        div.style.alignSelf = data.user === 'ecem' ? 'flex-start' : 'flex-end';
        
        // Admin modu iÃ§in silme butonu (varsa)
        let deleteBtn = document.body.classList.contains('admin-active') 
            ? `<button onclick="direktSil('chats', '${key}')" style="background:none; border:none; color:white; cursor:pointer; float:left; margin-right:5px;">Ã—</button>` 
            : '';

        div.innerHTML = `${deleteBtn} ${data.msg} <div style="font-size:8px; opacity:0.6; text-align:right;">${data.clock || ''}</div>`;
        
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
    }
});
// FotoÄŸrafÄ± normal boyutta aÃ§an fonksiyon
function openModal(src) {
    const modal = document.getElementById('imageModal');
    const modalImg = document.getElementById('modalContent');
    
    if(modal && modalImg) {
        modal.style.display = "flex"; // FotoÄŸrafÄ± ekranÄ±n ortasÄ±na hizalar
        modalImg.src = src; // TÄ±klanan fotoÄŸrafÄ±n adresini yÃ¼kler
        
        // FotoÄŸrafÄ±n ekranÄ± kaplamamasÄ± iÃ§in geniÅŸliÄŸini ayarla
        modalImg.style.maxWidth = "85%";
        modalImg.style.maxHeight = "80vh";
        modalImg.style.width = "auto";
        modalImg.style.height = "auto";
    }
}

// Modal penceresini kapatmak iÃ§in (DÄ±ÅŸarÄ± tÄ±klayÄ±nca kapanÄ±r)
window.onclick = function(event) {
    const modal = document.getElementById('imageModal');
    if (event.target == modal) {
        modal.style.display = "none";
    }
}
    </script>
</body>
</html>
